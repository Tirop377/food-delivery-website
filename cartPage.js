const food_list = [
    {
        _id: "1",
        name: "Greek salad",
        image: "food_1",
        price: 12,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Salad"
    },
    {
        _id: "2",
        name: "Veg salad",
        image: "food_2",
        price: 18,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Salad"
    }, {
        _id: "3",
        name: "Clover Salad",
        image: "food_3",
        price: 16,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Salad"
    }, {
        _id: "4",
        name: "Chicken Salad",
        image: "food_4",
        price: 24,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Salad"
    }, {
        _id: "5",
        name: "Lasagna Rolls",
        image: "food_5",
        price: 14,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Rolls"
    }, {
        _id: "6",
        name: "Peri Peri Rolls",
        image: "food_6",
        price: 12,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Rolls"
    }, {
        _id: "7",
        name: "Chicken Rolls",
        image: "food_7",
        price: 20,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Rolls"
    }, {
        _id: "8",
        name: "Veg Rolls",
        image: "food_8",
        price: 15,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Rolls"
    }, {
        _id: "9",
        name: "Ripple Ice Cream",
        image: "food_9",
        price: 14,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Deserts"
    }, {
        _id: "10",
        name: "Fruit Ice Cream",
        image: "food_10",
        price: 22,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Deserts"
    }, {
        _id: "11",
        name: "Jar Ice Cream",
        image: "food_11",
        price: 10,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Deserts"
    }, {
        _id: "12",
        name: "Vanilla Ice Cream",
        image: "food_12",
        price: 12,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Deserts"
    },
    {
        _id: "13",
        name: "Chicken Sandwich",
        image: "food_13",
        price: 12,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Sandwich"
    },
    {
        _id: "14",
        name: "Vegan Sandwich",
        image: "food_14",
        price: 18,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Sandwich"
    }, {
        _id: "15",
        name: "Grilled Sandwich",
        image: "food_15",
        price: 16,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Sandwich"
    }, {
        _id: "16",
        name: "Bread Sandwich",
        image: "food_16",
        price: 24,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Sandwich"
    }, {
        _id: "17",
        name: "Cup Cake",
        image: "food_17",
        price: 14,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Cake"
    }, {
        _id: "18",
        name: "Vegan Cake",
        image: "food_18",
        price: 12,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Cake"
    }, {
        _id: "19",
        name: "Butterscotch Cake",
        image: "food_19",
        price: 20,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Cake"
    }, {
        _id: "20",
        name: "Sliced Cake",
        image: "food_20",
        price: 15,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Cake"
    }, {
        _id: "21",
        name: "Garlic Mushroom ",
        image: "food_21",
        price: 14,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Pure Veg"
    }, {
        _id: "22",
        name: "Fried Cauliflower",
        image: "food_22",
        price: 22,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Pure Veg"
    }, {
        _id: "23",
        name: "Mix Veg Pulao",
        image: "food_23",
        price: 10,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Pure Veg"
    }, {
        _id: "24",
        name: "Rice Zucchini",
        image: "food_24",
        price: 12,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Pure Veg"
    },
    {
        _id: "25",
        name: "Cheese Pasta",
        image: "food_25",
        price: 12,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Pasta"
    },
    {
        _id: "26",
        name: "Tomato Pasta",
        image: "food_26",
        price: 18,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Pasta"
    }, {
        _id: "27",
        name: "Creamy Pasta",
        image: "food_27",
        price: 16,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Pasta"
    }, {
        _id: "28",
        name: "Chicken Pasta",
        image: "food_28",
        price: 24,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Pasta"
    }, {
        _id: "29",
        name: "Buttter Noodles",
        image: "food_29",
        price: 14,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Noodles"
    }, {
        _id: "30",
        name: "Veg Noodles",
        image: "food_30",
        price: 12,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Noodles"
    }, {
        _id: "31",
        name: "Somen Noodles",
        image: "food_31",
        price: 20,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Noodles"
    }, {
        _id: "32",
        name: "Cooked Noodles",
        image: "food_32",
        price: 15,
        description: "Food provides essential nutrients for overall health and well-being",
        category: "Noodles"
    }
]

let cart = [
    {
        name:"Greek salad",
        quantity: 5,
        id: "1"
    },
    {
        name:"Clover Salad",
        quantity: 4,
        id: "3"
    },
    {
        name:"Cooked Noodles",
        quantity: 5,
        id: "32"
    }
]

let allItemsHtml = "";
let totalprice = 0;

function genereteItemHtml() {
    food_list.forEach((food)=>{
        cart.forEach((item, index)=>{
            if(food._id === item.id){
                let foodPrice = (food.price*10 * (parseInt(item.quantity))).toFixed(2);
                totalprice += parseInt(foodPrice);
                 let itemDiv = `
                    <div class="item" data-index ="${index}">
                        <div>
                            <img src="./resources/foods-images/${food.image}.png" alt="img">
                        </div>
                        <div>
                            ${food.name}
                        </div>
                        <div>
                        Ksh ${(food.price*10).toFixed(2)}
                        </div>
                        <div>
                            <span class="quantitySpan">${item.quantity}</span>
                            <button class="updateBtn">update</button>
                            <div class="updateTools">
                                <input type="number" value="${parseInt(item.quantity)}" class="quantityInput"  min="1" max="8">
                                <button class="saveUpdate">Save</button>
                            </div>
                        </div>
                        <div>
                            Ksh <span class="itemTotalPriceSpan" data-price="${food.price}">${foodPrice}</span>
                        </div>
                        <div >
                            <button class="deleteButton">&times;</button>
                        </div>
                     </div>
                `
                allItemsHtml += itemDiv;
            }
        })
    })   
}

const itemsContainerDiv = document.querySelector(".items-container");
const subTotalSpan = document.querySelector(".subtotal");
const deliveryFeeSpan = document.querySelector(".deliveryFee");
const  totalPriceSpan = document.querySelector(".totalPriceSpan");

genereteItemHtml();
itemsContainerDiv.innerHTML = allItemsHtml;
let deliveryFee = 50;
deliveryFeeSpan.innerHTML = deliveryFee.toFixed(2);
subTotalSpan.innerHTML = totalprice.toFixed(2);
totalPriceSpan.innerHTML = (totalprice + deliveryFee).toFixed(2);

const deleteButtons = document.querySelectorAll(".deleteButton");
const items = document.querySelectorAll(".item")
console.log(cart)
deleteButtons.forEach((btn, index)=>{
    btn.addEventListener('click', ()=>{
        let indexInCart = parseInt(items[index].dataset.index);
        console.log(typeof indexInCart, indexInCart);
        cart.splice(0, 1);
        items[index].remove();
        let sub = findTotal();
        subTotalSpan.innerHTML = sub.toFixed(2)
        totalPriceSpan.innerHTML = (sub + deliveryFee).toFixed(2);
    })
})

const updateBtns = document.querySelectorAll(".updateBtn");
const quantityInputs = document.querySelectorAll(".quantityInput");
const saveUpdateBtns = document.querySelectorAll(".saveUpdate");
const quantitySpans = document.querySelectorAll(".quantitySpan");
const itemTotalPriceSpans = document.querySelectorAll(".itemTotalPriceSpan");
let updatedQuantity;
updateBtns.forEach((btn, index)=>{
    btn.addEventListener('click', ()=>{
        quantityInputs[index].style.display = "block";
        saveUpdateBtns[index].style.display = "block";
        updateBtns[index].style.display = "none";
        quantitySpans[index].style.display = "none";

        saveUpdateBtns[index].addEventListener('click', ()=>{
            updatedQuantity = quantityInputs[index].value;
            cart[index].quantity = updatedQuantity;
            updateBtns[index].style.display = "block";
            quantitySpans[index].style.display = "block";
            quantityInputs[index].style.display = "none";
            saveUpdateBtns[index].style.display = "none";
            quantitySpans[index].innerHTML = updatedQuantity;

            itemTotalPriceSpans[index].innerHTML = (parseInt(itemTotalPriceSpans[index].dataset.price)*parseInt(updatedQuantity)*10).toFixed(2);
            let sub = findTotal();
            subTotalSpan.innerHTML = sub.toFixed(2)
            totalPriceSpan.innerHTML = (parseInt(sub) + deliveryFee).toFixed(2)
        })
    })
})

function findTotal(){
    let sum = 0;
    food_list.forEach((food)=>{
        cart.forEach((item)=>{
            if(item.id === food._id){
                sum += parseInt(item.quantity)*parseInt(food.price)*10
            }
        })
    })

    return sum;
}





